---
title: "Trabajo Final"
author: "Luis Llanos y Cesar Clemente"
date: "17/12/2021"
output: html_document
---


# Introducción

 El domingo 6 de junio del presente año, se realizaron las elecciones de la segunda vuelta electoral con miras al sillón presidencial entre dos candidatos que bien podríamos decir se encontraban en las antípodas ideológicas.  En primer lugar, tenemos a Keiko Fujimori, quien postulaba por 3° vez a la presidencia de la república a través de su partido Fuerza Popular. Mientras que, en segundo lugar, tenemos a Pedro Castillo, un rondero, profesor y sindicalista, quien ya era conocido por haber dirigido la huelga general de maestros allá en el 2017 (RPP, 2021). Lo interesante de estas elecciones es que hubo bastante crispación entre la ciudadanía en general, por defender con capa y espada a ambos candidatos. Esto bajo el supuesto de que el candidato al que no apoyaban, ya sea Fujimori o Castillo representaría a la larga un peligro para la estabilidad de la nación (France24, 2021). 
 
Lo sorprende fue que, a pesar de todo el dinero invertido, así como el apoyo de diversos personajes tanto de la vida política, como de la farándula, así como del mundo del deporte, Keiko Fujimori perdió las elecciones presidenciales 2021. En sí una hipótesis para entender dicha victoria es la enorme desigualdad existente en el Perú, la cual influenció en que Castillo pudiese vender de manera efectiva su discurso de no más pobres en un país rico. No obstante, otro factor importante es el anti fujimorismo existente el cual provocó que muchas personas decidiesen votar por Castillo por sobre Keiko, bajo el argumento de que el sindicalista era un mal menor frente a la heredera del régimen fujimorista (Toledo, 2021). Asimismo, un factor importante que debe ser tomado en cuenta es que principalmente el sur apoyó fuertemente a Castillo, ya que al ser una de las zonas mayormente atrasadas del país consideran que Castillo los ayudará a salir adelante. Mientras que, en el caso del oriente la mayor parte de esta zona del país apoya a Fujimori, debido en que, en la memoria colectiva, Keiko será igual que su padre: realizará los mismos proyectos que trajeron “prosperidad” a la región (BBC, 2021).

 Esto nos lleva a la que será nuestra pregunta de investigación para el proyecto grupal del curso de Estadística 2 del ciclo 2021-2, la cual sería: ¿Cuáles son los factores que derivaron en la victoria de Pedro Castillo? Para conseguir responder está interrogante se decidió utilizar como base de datos la encuesta de intención de voto de la 2°vuelta electoral, patrocinada por la encuestadora DATUM, pero además se agregó data de una recolección de información realizada por la ONPE relacionada a la segunda vuelta electoral con miras a complementar la información presentada y tener un panorama más completo de la situación. Ahora bien, con respecto a que variables utilizaremos para averiguar qué factores generaron que las personas decidieran votar por Castillo, se decidió escoger: cobertura de servicios como agua o electricidad, acceso a servicios financieros, alta tasa de criminalidad, acceso a internet, tasa de criminalidad, etc.
 
Asimismo, al escoger variables como las indicadas para entender la victoria de Castillo se decidió también realizar las siguientes hipótesis (las cuales están avaladas, en parte, por la literatura). La primera de estas es que las regiones con menor cobertura de servicios de agua y electricidad son aquellas que decidieron votar por Pedro Castillo en la segunda vuelta electoral. Mientras que, la segunda hipótesis es que, las regiones sureñas, principalmente, decidieron votar por Pedro Castillo.  Asimismo, otra hipótesis es que las regiones donde las personas tienen menor acceso a los servicios financieros o credito principalmente son los que votaron a favor de Castillo. También, otra hipótesis es que las regiones con mayor percepción de criminalidad son aquellas que eligieron a Castillo. Por último, considero necesario resaltar que el objetivo general de este informe es comprender los factores que llevaron a que Castillo se siente hoy en día en el sillón presidencial. A la par que los objetivos específicos son: observar si las variables de servicios, zona de residencia, servicios financieros y percepción de criminalidad, tuvieron alguna influencia en que dicha victoria fuese posible. 

Fuentes
BBC. (2021). Elecciones en Perú: el mapa que explica la división del voto entre el "sur antisistema" favorable a Castillo y las ciudades que votaron por Fujimori. Recuperado el 11 de diciembre de 2021 de: https://www.bbc.com/mundo/noticias-america-latina-57394794 
DATUM. (2021). Intención de Voto - 21 mayo 2da vuelta 2021. Recuperado el 16 de diciembre de 2021 de: http://www.datum.com.pe/intencion-de-voto/base?mes=MayoIII2021 
FRANCE 24. (2021). Perú: una virtual presidencia frente a escenarios hostiles y pedidos antidemocráticos. Recuperado el 28 de octubre de 2021 de: https://www.france24.com/es/am%C3%A9rica-latina/20210616-peru-elecciones-pedro-castillo-virtual-presidencia 
RPP. (2021). Steven Levitsky: Pedro Castillo es muy radical y Keiko Fujimori es la reina de la impopularidad. Recuperado el 28 de octubre de 2021 de: https://rpp.pe/politica/elecciones/steven-levitsky-pedro-castillo-es-muy-radical-y-keiko-fujimori-es-la-reina-de-la-impopularidad-noticia-1333091?ref=rpp 
Toledo, Zaraí. (2021). Una guía para entender el Perú de Pedro Castillo. Recuperado el 28 de octubre de 2021 de: https://nuso.org/articulo/una-guia-para-entender-el-peru-de-pedro-castillo/ 


Parte practica

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
options(scipen=999) # No mostrar notación científica
```

# Planes de gobierno

Un resumen rápido y dinámico de los planes de gobierno de los dos partidos políticos inmmersos en la 2da vuelta electoral para la Presidencia en Perú 2021 se puede obtener a partir de la elaboración de nubes de palabras.    

Las nubes de palabras permiten realizar una representación visual de las palabras que conforman un texto, donde las palabras que aparecen con más frecuencia vienen representadas con textos de mayor tamaño.    

Empezaremos por el plan de gobierno del partido político "Perú Libre".   

## Nube de palabras del plan de gobierno de "Perú Libre"

```{r, warning=FALSE, message=FALSE}
library(pdftools)

text <- pdf_text("https://apisije-e.jne.gob.pe/TRAMITE/ESCRITO/2108/ARCHIVO/FIRMADO/9716.PDF")
text <- iconv(text, to="latin1")
```

Es normal que en la redacción de los documentos se usen múltiples sinónimos que, como la definición de sinónimos indica, son palabras con el mismo contenido semántico. Por ello, conviene efectuar un reemplazo de palabras.

```{r}
text <- gsub("público", "pública", text)
text <- gsub("públicas", "pública", text)
text <- gsub("políticas", "política", text)
text <- gsub("sistemas", "sistema", text)
text <- gsub("ciudadana", "ciudadano", text)
text <- gsub("ciudadanos", "ciudadano", text)
text <- gsub("gobiernos", "gobierno", text)
text <- gsub("ambientales", "ambiental", text)
text <- gsub("ambiente", "ambiental", text)
text <- gsub("cultural", "cultura", text)
text <- gsub("servicios", "servicio", text)
text <- gsub("sociales", "social", text)
text <- gsub("mejora", "mejor", text)
text <- gsub("ciudades", "ciudad", text)
text <- gsub("peruanas", "peruano", text)
text <- gsub("peruana", "peruano", text)
text <- gsub("peruanos", "peruano", text)
text <- gsub("todas", "todos", text)
```

Elaboración del corpus.  

```{r, warning=FALSE, message=FALSE}
library(tm)

corpus <- Corpus(VectorSource(text))
d <- corpus

d <- tm_map(d, tolower) #cambio a minúsculas
d <- tm_map(d, stripWhitespace) #eliminar espacios en blanco
d <- tm_map(d, removePunctuation) #eliminar signos de puntuación
d <- tm_map(d, removeNumbers) #eliminar números
```

Los stopwords son las palabras que por sí solas no guardan un significado. Son comunmente los artículos, pronombres, preposiciones y adverbios. No significa que carezcan de importancia, pero sí es necesario eliminarlas del corpus.   

```{r, warning=FALSE, message=FALSE}
lista_remover <- c('maría','ello','así','cada','hace','hacia','vez',
                   'través','sino','dentro','asimismo','mediante',
                   'además') #lista personalizada de stopwords
d <- tm_map(d, removeWords, c(stopwords("spanish"), lista_remover))
```

Matriz de términos.   

```{r, warning=FALSE, message=FALSE}
m <- as.matrix(TermDocumentMatrix(d))
v <- sort(rowSums(m), decreasing=TRUE)
t <- data.frame(word=names(v), freq=v)
```

`r paste0("Nube de ",sum(t$freq)," palabras.")`

```{r, out.width = "900px", fig.height=6, fig.width=6}
library(wordcloud2)
wordcloud2(t, size=0.75, backgroundColor="black", 
           color='random-light', shuffle=F)
```

Al observar la lista de palabras más repetidas dentro del plan de lo que es Perú Libre, podemos observar que las principales serían programa, trabajo, debe, nacional, sector, social, deuda, recursos, empresa. En sí la aparición de estas palabras no debería sorprendernos, dado que la "ideología" de Perú Libre al ser Marxismo, Leniismo, Mariateguismo, debería de por sí tener un discurso autoritario:por lo que se entiende el porque DEBE es la palabra más repetida en todo el programa. Asimismo, para mostrar a la ciudadanía  que ellos (Perú Libre) no están bromeando respecto a que saben dirigir el país repiten 63 veces la palabra programa, casi como queriendo echarnos en la cara que ellos tienen un programa, mientras que los otros partidos  no tienen nada.  



## Nube de palabras del plan de gobierno de "Fuerza Popular"

```{r, warning=FALSE, message=FALSE}
library(pdftools)

text <- pdf_text("https://apisije-e.jne.gob.pe/TRAMITE/ESCRITO/1095/ARCHIVO/FIRMADO/3017.PDF")
text <- iconv(text, to="latin1")
```

Es normal que en la redacción de los documentos se usen múltiples sinónimos que, como la definición de sinónimos indica, son palabras con el mismo contenido semántico. Por ello, conviene efectuar un reemplazo de palabras.

```{r}
text <- gsub("público", "pública", text)
text <- gsub("públicas", "pública", text)
text <- gsub("políticas", "política", text)
text <- gsub("sistemas", "sistema", text)
text <- gsub("ciudadana", "ciudadano", text)
text <- gsub("ciudadanos", "ciudadano", text)
text <- gsub("gobiernos", "gobierno", text)
text <- gsub("ambientales", "ambiental", text)
text <- gsub("ambiente", "ambiental", text)
text <- gsub("cultural", "cultura", text)
text <- gsub("servicios", "servicio", text)
text <- gsub("sociales", "social", text)
text <- gsub("mejora", "mejor", text)
text <- gsub("ciudades", "ciudad", text)
text <- gsub("peruanas", "peruano", text)
text <- gsub("peruana", "peruano", text)
text <- gsub("peruanos", "peruano", text)
text <- gsub("todas", "todos", text)
```

Elaboración del corpus.  

```{r, warning=FALSE, message=FALSE}
library(tm)

corpus <- Corpus(VectorSource(text))
d <- corpus

d <- tm_map(d, tolower) #cambio a minúsculas
d <- tm_map(d, stripWhitespace) #eliminar espacios en blanco
d <- tm_map(d, removePunctuation) #eliminar signos de puntuación
d <- tm_map(d, removeNumbers) #eliminar números
```

Los stopwords son las palabras que por sí solas no guardan un significado. Son comunmente los artículos, pronombres, preposiciones y adverbios. No significa que carezcan de importancia, pero sí es necesario eliminarlas del corpus.   

```{r, warning=FALSE, message=FALSE}
lista_remover <- c('maría','ello','así','cada','hace','hacia','vez',
                   'través','sino','dentro','asimismo','mediante',
                   'además') #lista personalizada de stopwords
d <- tm_map(d, removeWords, c(stopwords("spanish"), lista_remover))
```

Matriz de términos.   

```{r, warning=FALSE, message=FALSE}
m <- as.matrix(TermDocumentMatrix(d))
v <- sort(rowSums(m), decreasing=TRUE)
t <- data.frame(word=names(v), freq=v)
```

`r paste0("Nube de ",sum(t$freq)," palabras.")`

```{r, out.width = "900px", fig.height=6, fig.width=6}
library(wordcloud2)
wordcloud2(t, size=0.75, backgroundColor="black", 
           color='random-light', shuffle=F)
```

En cuanto al programa de Fuerza Popular podemos apreciar la repetición sistematica de ciertos palabras tales como sistema, empleo, salud, debe, etc. En cuanto a la primera se puede entender, ya que el partido de Fujimori busca proteger todo lo referente al status Quo en específico la Constitución del 93. Asimismo, hace enfasis en empleo y salud, ya que debido a la pandemia mucha genete o no ha tenido acceso a un buen sistema de salud, lo que derivó en su muerte o simplemente perdió su empleo y por ende la única forma de mantener a su familia. Ante este panorama Fujimori promete mejorar esta situación por lo cual es comprendible el poruqw estas palabras se repiten de manera sistematica en su plan de gobierno. 


# Metodología
En base a que nuestra variable dependiente que es la tasa de votos de Castillo por región, se ha decidido que el enfoque que vamos a utilizar para analizar nuestras variables será un modelo de regresión logística. Asimismo, debemos señalar que método que se aplicará es uno experimental, dado que los datos que vamos a analizar se obtuvieron de manera directa, mas, no obstante, los mismos ya fueron estudiados y convertidos en datos porcentuales (numéricos), por lo menos en el caso de la ONPE. También señalar que, salvo la edad, el resto de los datos numéricos son a nivel regional: son los mismos para encuestado de la región. A la par, vale resaltar no existen datos cuantitativos para Lima Metropolitana, Callao y Lima Provincias, como consecuencia de que la base de datos de la ONPE, conformada por las variables numéricas que están dentro de la base de datos (datos.rsd), no contaba a Lima en general como parte de su estudio debido a que querían analizar el comportamiento, meramente, de las regiones. Razón por la que decidieron eliminar esta variable de la base de datos.  

Por otra parte, en lo referente al proceso de recolección de datos, debo enfatizar que la encuestadora DATUM realizó recolección de data, la cual colocó los datos de manera directa aunque solo los convirtió en números, a la par la información fue recolectada de manera presencial (siguiendo todos los protocolos de bioseguridad), en las cuales se le presentaba a las personas una cartilla con distintos temas que debían de responder. También, en lo referente a la muestra, de resaltarse que la encuestadora escogió a personas de diversos estratos socio-económicos, localizadas en distintos sectores del país y que, además, tuviesen entre 18 y 65 años. En ese sentido bien podríamos estar frente a un modelo aleatorio simple. 

Además, en el caso de la data recolectada por ONPE, esta fue obtenida antes de la segunda vuelta electoral, con miras a tener una mayor precisión respecto al panorama electoral. Dado que, solo así podrían comprender el panorama electoral: porque algunas regiones decían apoyar a Castillo y porque otras decidían apoyar a Fujimori. En ese sentido, podemos estar frente a un modelo de recolección de datos que, más adelante, fueron convertidos en datos porcentuales por la ONPE lo que se entendería como un metodo experimental. Por último, para analizar las variables que descargamos en nuestro R Studio y contrastarlas con las hipótesis diseñadas por nuestras personas (las cuales se basan en literatura) decidimos que lo mejor era analizar las variables independientes: cobertura de servicios como agua o electricidad, acceso a servicios financieros, alta tasa de criminalidad, acceso a internet, tasa de educativa (comprende compresión lectora y matemática), etc; junto con la variable dependiente que sería la tasa de votos por Castillo,  a través del método de correlación. De ese modo, se podrá demostrar si verdaderamente hay relación entre el voto por Castillo y las respectivas variables independientes.

En ese sentido, lo primero que nos plantearíamos sería empezar con un análisis exploratorio de los datos, realizar gráficos con miras a comparar los votos que iban dirigidos tanto a Keiko como a Castillo con nuestras respectivas variables independientes: sexo, región, región natural, NSE y área geográfica. Es por ello, que se observarían gráficos de barras construidos a través de las funciones table y ggplot, con los distintos votos tanto para Castillo, como para Keiko distribuidos por las diversas opciones dentro de una variable. Por ejemplo, en el caso de la variable sexo, se apreciaría los votos obtenidos tanto por Keiko como por Castillo de acuerdo al sexo. Ello significa que sabríamos por cuál de los dos candidatos tiene preferencia tanto el sexo masculino como el femenino. De ahí lo que haríamos sería un mapa, analizando el último gráfico realizado por este grupo, ello con miras a saber cuáles fueron, específicamente, las regiones que eligieron a Castillo. 

También después de realizar estos gráficos, se decidió realizar un mapa poner de manera más amigable el gráfico en donde aparecían las regiones en donde habían ganado tanto Castillo como Keiko (con los colores rojo y naranja respectivamente). Para lograr este objetivo, se utilizó la library (MapsPERU), la library (sf) y la library (ggplot2), ello con la finalidad que se dividiese en tres secciones regiones en donde ganó Castillo, regiones en donde ganó y, regiones en donde podría haber habido lo que se entiende como empate técnico. A través de estos mapas podríamos tener un panorama de cómo se dividió el Perú en estas elecciones. 

Luego, usamos el library psych y la función corPlot para crear nuestra tabla de correlaciones. Asimismo, decidimos usar la función boxplot para crear cajas de bigotes de gato de nuestras respectivas variables numéricas, he de ahí el porque en la función boxplot colocamos nuestra base de datos (solo las variables cuantitativas) con miras a saber si nuestras variables numéricas tienen valores atípicos o no. 
 
Por último, se procedió a elaborar el modelo de regresión logística, con miras a observar si las variables seleccionadas son válidas para realizar la clasificación binaria. Recordar que la variable VOTO es la que recoge la preferencia del encuestado (Pedro Castillo o Keiko Fujimori).
En el primer modelo se utilizaron todas las variables cuantitativas y cualitativas (a excepción de  Region y RegionNatural). Se observó que se debía recategorizar la variable NSE para una mejor estimación. 

Con la recategorización de la variable NSE se elaboró un segundo modelo. De cuyos resultados se observó que algunas variables cuantitativas (Edad, PPTO_PublicoPerCapita , BrechaGeneroIngresos, DisponibilidadServiciosFinancieros, CoberturaElectricidad, CoberturaAgua, HogaresCelular, EmpleoAdecuado, ResolucionExpedientesJudiciales) y cualitativas (AreaGeografica) deberían retirarse del modelo. Sin las variables retiradas se elaboró un tercer modelo, a partir del cual se calculó la exactitud de las predicciones, lo cual arrojó un 72.3% de acierto. Finalmente se realizó un Análisis de Componentes Principales con miras a observar las posibilidades de reducción de dimensionalidad.


# Pre procesamiento de los datos

## Importar datos

```{r}
df <- read_rds("datos.rds")
glimpse(df) # Estructura dataset
```

## Resumen

Observemos un resumen de los datos.

```{r}
summary(df)
```

## Filtrar

Dado que el interés está enfocado en solo la intención de voto por Pedro Castillo o Keiko Fujimori, mantendremos en el dataset solo a estos dos grupos de personas.  
```{r}
df <- filter(df, Voto=="Pedro Castillo" | Voto=="Keiko Fujimori")
df$Voto <- factor(df$Voto, levels = c("Pedro Castillo","Keiko Fujimori"))
```

## Detectar omisiones

Las líneas rojas representan los valores omisos.  

```{r, message=FALSE, warning=FALSE}
library(VIM)
matrixplot(df, sortby="Voto", axes=T, interactive=F) 
```

```{r}
colSums(is.na(df)) # Variables con omisiones  

table(ifelse(rowSums(is.na(df))==0, "NOesNA", "SIesNA"), df$RegionNatural)
```

Como se observa, las omisiones corresponden a la región natural "Lima, Callao, Lima Provincias". Por tanto, eliminaremos los registros correspondientes a esta región natural.  

```{r}
df <- filter(df, RegionNatural!="Lima, Callao, Lima Provincias")
```

# Gráficos de variables categóricas  

Será útil realizar gráficos de frecuencias de las variables categóricas en función de la variable objetivo (Voto).   

```{r}
dfCAT <- select(df, Voto, Sexo, AreaGeografica, NSE, RegionNatural, Region)

glimpse(dfCAT)
```

```{r}
for(i in 2:(dim(dfCAT)[2])) {
  
  a = colnames(dfCAT)[i]
  b = cbind(dfCAT[1],dfCAT[i])
  
  tabla <- data.frame(table(b[,1],b[,2]))
  colnames(tabla) <- c("Voto", "var", "Frecuencia")
  
  p = ggplot(data=tabla, aes(x=var, y=Frecuencia, fill=Voto)) + 
    geom_col() +
    labs(title = paste("Voto vs.",a), x=a) +
    theme(legend.position = "top") +
    scale_fill_manual(values = c("#ff0000", "#ed6e00")) +
    theme(axis.text.x=element_text(angle=45, hjust=1))
  
  print(p)

}
```

El primer gráfico que es los votos obtenidos por ambos candidatos en relación al sexo demuestra que una predominancia por los hombres a elegir a Pedro Castillo, algo que sin duda no fue encontrado en la literatura revisada, esta realidad tendría sus bases en el hecho de que el Perú es un país machista, por lo que los hombres no sentirían que una mujer los representaría de la manera adecuada en el poder. Por otra parte, en lo referente por área geográfica se nota que en las zonas rurales hay mayor predominancia por Castillo, en contraste con la urbana donde los votos de ambos candidatos están casi igualados. Ello se debería a que Castillo representa para las zonas rurales alguien igual que ellos, por lo que la ciudadanía en esta zona está de acuerdo en darle su voto. Mientras que, en el caso de la zona urbana, la ciudadanía estaría dividida a la mitad, debido al factor antifujimorismo, el cual provoca que la ciudadanía vote por cualquier candidato en la segunda vuelta, si es que el mismo se enfrente a un Fujimori, ello según la politologa Zaraí Toledo.

En cuanto a los votos por nivel socioeconómico podemos observar que el candidato del sombrero llevaba la delantera en zonas de bajo nivel: E y rural, lo cual coincide con la literatura revisada que hace énfasis en que las zonas con menor nivel socioeconómico fueron las más seducidas por el sombrero. Ello se debería a que este personaje realizó promesas en campaña, muchas de ellas populistas, pero que generaron en dicho sector de la población la esperanza de que si este señor llegase al poder la situación iba a cambiar. Con respecto a los otros sectores (C y D) podemos apreciar una suerte de lucha entre ambos candidatos: ello se debería a que ambos son populares en esos sectores. Mientras que en el sector A/B la situación varía ya que, en el mismo, gana la candidata Fujimori, muy probablemente ello se debe a para este sector el candidato Castillo es un candidato populista que representa el “comunismo” y la desigualdad hacia abajo, por lo que es sumamente dañino a los intereses de este grupo.

En cuanto a los votos por región natural podemos apreciar una predominancia en el sur del país por Castillo, lo cual concuerda con los datos presentados por las encuestadoras, así como por la prensa. No obstante, el gráfico también da a resaltar un dato importante y es que buena parte del centro país también voto por Castillo. Mientras que la heredera de la dinastía Fujimori gana en los sectores tanto del Norte como del oriente del país, algo que también fue resaltado por politólogos, así como la prensa internacional. Por último, se aprecia el gráfico en donde se observa la frecuencia de votos (tanto para Castle como para la señora K) por región.

El último gráfico es mejor observarlo en un mapa.  

```{r, message=FALSE}
tabla <- data.frame(table(df$Region, df$Voto))
colnames(tabla) <- c("REGION","Voto","Frecuencia")

tabla <- spread(tabla, Voto, Frecuencia)

tabla$Preferencia <- ""
tabla$Preferencia <- ifelse(tabla$`Pedro Castillo`>tabla$`Keiko Fujimori`,
                            paste0("Pedro Castillo"), tabla$Preferencia)
tabla$Preferencia <- ifelse(tabla$`Pedro Castillo`<tabla$`Keiko Fujimori`,
                            paste0("Keiko Fujimori"), tabla$Preferencia)
tabla$Preferencia <- ifelse(tabla$`Pedro Castillo`==tabla$`Keiko Fujimori`,
                            paste0("Empate"), tabla$Preferencia)

library(mapsPERU)
library(sf)
mapa <- map_REG
mapa <- left_join(mapa, tabla, by = "REGION")
mapa <- filter(mapa, is.na(Preferencia)==F)
mapa$Preferencia <- factor(mapa$Preferencia, levels = c("Pedro Castillo",
                                                        "Keiko Fujimori",
                                                        "Empate"))
```

```{r, out.width = "3000px", fig.height=15, fig.width=12}
library(ggplot2)
colores <- c("#ff0000", "#ed6e00", "white")
ggplot(mapa, aes(geometry=geometry)) +
  geom_sf(aes(fill=Preferencia)) +
  geom_text(data=mapa, aes(coords_x, coords_y, group=NULL, label=REGION), size=3) +
  scale_fill_manual(values=colores)+
  labs(x="", y="")
```
El mapa que tenemos aquí presente nos muestra un panorama más directo. En sí podemos apreciar lo que distintos investigadores ya habían dicho que el Sur, apoya defintivamente a Castillo. Ello se debería a que dicho sector del país al carecer de la presencia del Estado,lo cual provoca una percepción de abandono, se siente identificado con un discurso populista como el propuesto por Pedro Castillo como fue el no más pobres en un país rico, puesto que siente que por fin alguien los ayudará con sus problemas como es la falta de acceso a recursos, mejor calidad educativa, más seguridad,ect. Lo interesante es que este mapa muestra que cierta parte del centro país también apoya a Castillo, esto se debería a que, por muchos años de corrupción provocada por gobiernos regionales, la ciudadanía siente que necesitan a alguien que no pertenezca al Status Quo de vida politica y ante ello, el único de los dos candidatos que promete cambios en el panorama de la vida política y de paso en la vida de varios ciudadanos para "bien"es Castillo. En este punto debo resaltar que esto es una suposición, ya que la literatura no hace mucha mención acerca de la preferencia del centro del país por candidatos populitas, más bien muchos analistas suponen que el centro sería más Fujimorista ya que varias regiones tienen un mal recuerdo respecto a gobiernos populistas de izquierdas, por la corrupción como es el caso del gobierno de Castillo. 

Asimismo, el mapa demuestra algo que diversos analistas ya habían resaltado,e ntre ellos, Zaraí Toledo y Steven Levitsky y es que tanto el Norte como el oriente del país siepre han sido bastiones del Fujimorismo, cada vez que Keiko se postula en las elecciones presidenciales. Ello debido a que para la ciudadanía de esta parte del país, el apellido Fujimori es sinonimo de progreso. Ya que, durante el gobierno autoritario de Alberto Fujimori se realizaron diversas constrcciones y se aplicaron programas sociales. Ahora bien, las construcciones se caían y los programas eran, en la mayoría de los casos, cuasi ineficientes; no obstante, la población de dichas regiones siento que por fin alguien(Alberto) hacía algo por ellos, se preocupaba por ellos. Y ello, generá que en estos tiempos la población crea que Keiko (la sucesora de Alberto) realizará las mismas obras que en su momento realizó su padre (Aunque viendo el panorama actual, Keiko no sería capaz ni de realizar una chocolatada)


# Matriz de correlaciones

Una matriz de correlación entre las variables numéricas nos puede ayudar a descubrir las relaciones en el dataset.  

Antes de ello, crearemos una función que nos permita seleccionar del dataset solo a las variables numéricas o bien solo a las que no son numéricas, según sea el caso de nuestra necesidad.  

```{r}
CutDF <- function(df, b="num"){
  lista <- data.frame(sapply(df, is.numeric))
  lista$var <- row.names(lista)
  colnames(lista) <- c("vf","var")
  
  if(b=="num"){
    lista <- filter(lista, vf==TRUE)
  }else if (b=="cat"){
    lista <- filter(lista, vf!=TRUE)
  }
  
  lista <- c(lista[,2])
  df <- df[,lista]
  return(df)
}
```

```{r}
dfNUM <- CutDF(df, "num")

glimpse(dfNUM)
```

```{r, out.width = "3000px", fig.height=15, fig.width=15}
library(psych)
corPlot(dfNUM, scale = F, cex = 1, stars = T) 
```

La interpretación de cada valor de la matriz de correlación debe ir acompañada siempre de la significancia correspondiente. Es así que, a mayor número de asteriscos, se debe interpretar como un mayor nivel de significancia.  En ese sentido, podemos apreciar que la mayoría de variables seleccionadas, para realizar el presente trabajo, comparten una relación casi en su mayoría sumamente fuerte. Asimismo, cabe señalar que en la mayoría de casos  todas las variables, con excepción de Edad y PBI per capita, mantienen una relación entre 0.3 a 0.8. Ello siginifica que en sí el modelo que podría aplicarse en un futuro debería de ser validado. 

# Boxplot

Otros aspecto a evaluar antes de elaborar un modelo estadístico es inspeccionar si existen outliers. Para ello, es útil realizar diagramas de caja (boxplots) para las variables numéricas.  

```{r}
for (i in colnames(dfNUM)) {
  boxplot(dfNUM[colnames(dfNUM)==i], main=i)
}
```

Como se observa, si bien es cierto que existen algunos valores outliers, estos no son demasiados como pensar que afectarían las estimaciones estadísticas.En ese sentido, podemos ver que todas las variables analizadas a través de la funció boxplot o caja de bigotes de gato tienen un peso aceptable por lo que se sobre entiende que las variables aquí presentadas son válidadas para proseguir con el análisis.  


# Regresión logística

```{r}
modelo_glm1 <- glm(Voto ~ . -Region -RegionNatural, data = df, family = "binomial")
summary(modelo_glm1)
```

```{r}
table(df$NSE, useNA = "alw")
```

Como se observa, respecto al Nivel Socio Económico (NSE), es conveniente agrupar algunas categorías, a fin de obtener una estimación correcta en el modelo.  

```{r}
df$NSE <- ifelse(df$NSE=="E" | df$NSE=="R", "E | R", df$NSE)
```

```{r}
modelo_glm2 <- glm(Voto ~ . -Region -RegionNatural, data = df, family = "binomial")
summary(modelo_glm2)
```

A fin de mejorar el modelo, retiraremos las variables cuyos coeficientes son no significativos.  

```{r}
modelo_glm3 <- glm(Voto ~ . -Region -RegionNatural -Edad -AreaGeografica -PPTO_PublicoPerCapita -BrechaGeneroIngresos -DisponibilidadServiciosFinancieros -CoberturaElectricidad -CoberturaAgua -HogaresCelular -EmpleoAdecuado -ResolucionExpedientesJudiciales, data = df, family = "binomial")
summary(modelo_glm3)
```

Evaluar la validez y calidad de un modelo de regresión logística implica analizar tanto el modelo en su conjunto como los predictores que lo conforman. Se considera que el modelo es útil si es capaz de mostrar una mejora explicando las observaciones respecto al modelo nulo (sin predictores). El test Likelihood ratio calcula la significancia de la diferencia de residuos entre el modelo de interés y el modelo nulo. El estadístico sigue una distribución chi-cuadrado con grados de libertad equivalentes a la diferencia de grados de libertad de los dos modelos.  

```{r}
dif_residuos <- modelo_glm3$null.deviance - modelo_glm3$deviance
gl <- modelo_glm3$df.null - modelo_glm3$df.residual
p_value <- pchisq(q = dif_residuos, df = gl, lower.tail = FALSE)
```

`r paste0("p-value:", round(p_value, 4))`.
Podemos afirmar entonces que el modelo, en su conjunto, es estadísticamente significativo.  

Una mejor forma de medir que tan eficiente es el modelo, es elaborar una matriz de confusión, en la cual los resultados posibles son:  
+ Verdadero positivo: El valor real es positivo y  la prueba predijo tambien que era positivo. En nuestro caso, es valor real "Pedro Castillo" y predicción "Pedro Castillo".  
+ Verdadero negativo: El valor real  es negativo y la prueba predijo tambien que el resultado era negativo. En nuestro caso, es valor real "Keiko Fujimori" y predicción "Keiko Fujimori".     
+ Falso negativo: El valor real es positivo, y la prueba predijo  que el resultado es negativo. Esto es lo que en estadística se conoce como error tipo II. En nuestro caso, es valor real "Pedro Castillo" y predicción "Keiko Fujimori".    
+ Falso positivo: El valor real es negativo, y la prueba predijo  que el resultado es positivo. Esto es lo que en estadística se conoce como error tipo I. En nuestro caso, es valor real "Keiko Fujimori" y predicción "Pedro Castillo".    

```{r}
predicciones <- ifelse(test = modelo_glm3$fitted.values < 0.5, yes = "Pedro Castillo", no = "Keiko Fujimori")
matriz_confusion <- table(modelo_glm3$model$Voto, predicciones,
                          dnn = c("observaciones", "predicciones"))
matriz_confusion
```

La exactitud (Acurracy) se mide como el porcentaje de la data clasificada correctamente. Es decir, (148+295)/(76+295+148+94) =
`r round((148+295)/(76+295+148+94)*100,1)`%.  

En contraste, la tasa de error es el porcentaje de la data clasificada incorrectamente. Es decir, (76+94)/(76+295+148+94) =
`r round((76+94)/(76+295+148+94)*100,1)`%.  

```{r, out.width = "500px", fig.height=7, fig.width=7}
library(grid)
library(vcd)
vcd::mosaic(matriz_confusion, shade = T, colorize = T,
       gp = gpar(fill = matrix(c("#ff0000","#ed6e00","#ff0000","#ed6e00"), 2, 2)))
```


# Reducción de dimensiones

Las razones por las que nos interesaría reducir la dimensionalidad son varias:
+ Porque interesa identificar y eliminar las variables irrelevantes.   
+ Porque no siempre el mejor modelo es el que más variables tiene en cuenta. 
+ Porque se mejora el rendimiento computacional, lo que se traduce en un ahorro en coste y tiempo.
+ Porque se reduce la complejidad, lo que lleva a facilitar la comprensión del modelo y sus resultados.

## Análisis de Componentes Principales (PCA)

El Análisis de Componentes Principales (PCA) tiene como objetivo transformar un conjunto de variables, a las que se denominan variables originales, en un nuevo conjunto de variables denominadas componentes principales. Estas ultimas se caracterizan por estar no correlacionadas entre sí.  

Siendo el objetivo del PCA reducir la dimensionalidad, suelen ser de interés utilizar el número mínimo de componentes que resultan suficientes para explicar los datos. No existe una respuesta o método único que permita identificar cual es el número óptimo de componentes principales a utilizar. Una forma de proceder muy extendida consiste en evaluar la proporción de varianza explicada acumulada y seleccionar el número de componentes mínimo a partir del cual el incremento deja de ser sustancial.   

El cálculo de los componentes principales depende de las unidades de medida empleadas en las variables. Es por tanto importante, antes de aplicar el PCA, estandarizar las variables para que tengan media 0 y desviación estándar 1, ya que, de lo contrario, las variables con mayor varianza dominarían al resto.  

```{r}
pca <- prcomp(dfNUM, scale=T) # scale=T para estandarizar las variables
print(pca)
summary(pca)
```

```{r}
prop_varianza_acum <- cumsum(pca$sdev^2/sum(pca$sdev^2))

library(ggplot2)
ggplot(data = data.frame(prop_varianza_acum, pc = factor(1:16)),
       aes(x = pc, y = prop_varianza_acum, group = 1)) +
  geom_point() +
  geom_line() +
  geom_label(aes(label = round(prop_varianza_acum,2))) +
  labs(x = "Componentes principales", 
       y = "Proporción de varianza explicada acumulada")
```

En este caso, como puede observarse en el gráfico, habría que tomar un número arbitario de dimensiones, pues no es muy claro qué número de dimensiones es suficiente para asegurar que el incremento en la proporción de varianza explicada acumulada deja de ser sustancial.  

# Hallazgos

Según podemos mencionar, uno de los primeros hallazgos localizados en este trabajo se ha logrado utilizando una visualización de nube de palabras de los planes de gobierno de cada partido. Al respecto, el plan de gobierno del primero hace énfasis en palabras como programa, social, debe, recursos, pueblo, nacional, mercado, etc. Estas palabras sin duda tienen relación con el partido político Perú Libre, ya que el mismo al ser de una línea izquierdista populista, ello según la politóloga Zaraí Toledo, evidentemente buscarían la redistribución de recursos, buscarían aplicar diversos programas sociales y, tal vez, hasta mejorar los que ya existen. 

Por otra parte, con respecto al programa de Fujimori, este repite palabras tales como PBI, modelo, recursos, manera, gasto, etc. Es entendible el porque estas palabras se repiten ya que de acuerdo al politólogo Steven Levitsky, lo que Keiko busca con este programa es una suerte de protección del modelo económico implementado durante el gobierno autoritario de su padre Alberto en lo que es la Constitución del 93. Por ello, no es complicado, entender el porque todas las palabras señaladas anteriormente se repiten de manera regular en su plan de gobierno. Además, necesario señalar que, para varios medios internacionales, así como otros analistas políticos, Keiko representa una derecha con guiños autoritarios, por lo que es más que comprensible porque su plan de gobierno tenga la intención de ser casi una respuesta a todos estos aires de cambio que representan movimientos sociales que buscan un cambio de sistema (no necesariamente a través del cambio de Constitución).

Ahora bien, entrando al meollo del trabajo, podemos apreciar que, en general, todas las hipótesis planteadas por este grupo resultaron verdaderas con excepción de una. Esta sería la que enfatiza, que las regiones con menor cobertura de servicios de agua y electricidad son aquellas que decidieron votar por Pedro Castillo. Esta decidió retirarse porque no tenía valores significativos, ergo no es suficiente para explicar el voto por el sombrero. Asimismo, respecto a la segunda hipótesis la cual plantea que las regiones sureñas, principalmente, decidieron votar por Pedro Castillo, se demostró que esta hipótesis es verdadera. Ello, después claro, de diseñar un mapa donde se mostrase cual candidato había ganado en cada región (rojo=castillo, naranja=Fujimori). Ello sin duda muestra que el sur siempre va a estar a favor de opciones disruptivas, (esto en base a la literatura), puesto que tienen la percepción de que las mismas ayudaran a romper este bucle de pobreza y abandono en que muchos de ellos creen que viven. 

Asimismo, se realizó otro descubrimiento y fue que, en las regiones tanto del norte como del oriente peruano votaron por la señora Fujimori. Ello debido a que para varios de estos conciudadanos Keiko actuara igual a como actuó su padre, el expresidente Alberto Fujimori: construirá pistas, colegios, baños; es decir, hará sentir la presencia del Estado y “ayudará” a que las personas salgan adelante. Por otra parte, respecto a la hipótesis que enfatiza las regiones donde las personas tienen menor acceso a los servicios financieros o credito principalmente son los que votaron a favor de Castillo. Ello se demostró parcialmente no solo por el modelo 3 al ser < que 0.5 muestra que estas dos variables son validas para explicar el porqué de la victoria de Castillo, sino además por el mapa que muestra que las regiones tanto del sur como del centro (las cuales son las que peores indicadores en materia de inclusión financiera tienen) votaron por Castillo. Suponemos por la creencia de que Castillo a través de su discurso prometía no más pobres en un país rico, lo cual pudo haber dado la esperanza de que por fin ellos (los pobladores de estas regiones) podrían por fin participar de tan aclamado milagro económico y de las instituciones que este representa.

Con respecto a la hipótesis que resalta las regiones con mayor percepción de criminalidad son aquellas que eligieron a Castillo, de acuerdo con los modelos planteados las regiones con mayor criminalidad si escogieron a Castillo. De hecho, el valor de esta variable es menor que 0.5, por lo que se entiende que la hipótesis planteada es verídica. Este dato coincide con la teoría de la politóloga Toledo, quien enfatiza que Castillo, al haberse presentado como un rondero (cuando todos sabe que es solamente un sindicalista) es observado como una figura que traerá autoridad y orden al país, razón por la cual es necesario darle su voto. 

Asimismo, otro descubrimiento interesante y que ya fue señalado es que el sexo masculino es el que principalmente votó por Castillo. Si bien de esto no hay mucha evidencia suponemos que, debido a que, estamos en un país machista los hombres tienen la percepción de que una mujer (como es la señora Fujimori) no es alguien que sea “apta” para ser líder de la nación peruana. Asimismo, otra teoría para explicar esta realidad es que para los hombres en sí Castillo representa esta idea o noción de lo que debería de ser un hombre: alguien conservador, algo religioso, que defiende a su familia de la nefasta ideología de género y del progresismo (tal y como hizo en algunos discursos de campaña), etc (France 24, 2021); razón por la cual parece factible votar por él. 

Por último, se descubrió a través del modelo glm que otras variables válidas para explicar la victoria del sombrero pero que todavía son la presencia de internet  en los hogares peruanos. Esto se descubrió después de percatarnos que en los modelos planteados estas dos variable cumplía con los requisitos válidos. Ahora si bien para demostrar esta hipótesis no hay evidencia que la sustente, bajo la premisa de un supuesto creamos que el motivo por el que este factor ayudo a Castillo a ganar se debe a que muchas familias no pudieron ni informarse ni informar sobre lo que sabían acerca de Castillo. En otras palabras, no podían tener acceso a información respecto al candidato de Perú Libre. Por lo que entre votar por alguien que prometía grandes cambios o votar por alguien quien ya es despreciada por la sociedad peruana (Keiko), prefirieron votar por el primero. 


# Conclusión 

En general, a través de este trabajo, como grupo, hemos podido demostrar diversos factores que influyeron en la victoria de Pedro Castillo en las distintas regiones: tales como la región en donde uno vive, acceso a servicios financieros, acceso a una buena educación, la tasa de criminalidad, etc. En ese sentido, es bastante interesante observar que todos estos actores hayan provocado que en la actualidad el Perú se encuentre gobernado por un gobierno izquierdista ineficiente y que se desdice a cada rato. También, debo resaltar que a medida que avanzábamos con la investigación, descubrimos otros datos asombrosos como que el hecho de ser hombre influyo bastante en victoria de Castillo, dado que el pensamiento machista peruano primo al momento de escoger entre el candidato del sombrero y la heredera de Fujimori. 

En sí, se diría que toda investigación podría servir como continuidad para poder observar cuales factores influyen la victoria de ciertos candidatos. E incluso podría servir para darle con más fuerza a estudios que vean a género como factor importante para la elección de un candidato. También, descubrimos que los factores como el acceso a agua y electricidad no tuvieron una significancia fuerte en porque Castillo fue elegido, por lo que fueron retiradas y demostraron nos equivocamos en una hipótesis al momento de plantear que el acceso a estos servicios era indispensable para entender la victoria de castillo. A la par, nos equivocamos parcialmente al momento de querer colocar las avriables accceso a instituciones financieros y credito como si fuesen una sola variable: solo la última es válida para entender la victoria de Castillo.

Asimismo, vale la pena resaltar que hacer este informe fue bastante complicado, sobre todo a la hora de revisar bases de datos, dado que o había solo puramente numéricas o puramente categóricas. Ante dicho inconveniente se nos ocurrió que la mejor solución era unir dos bases de datos, para tener una visión más completa del panorama: una base de datos con variables de ambos tipos. Por ello, consideramos desde nuestra posición como alumnos que, para la próxima, se crean bases de datos más completas con miras a tener una investigación mucho más enriquecedora, sobre cualquier tema en particular.  Además, considero en si que no hubo una hipótesis que no fuese resuelta en esta investigación, mas si me gustaría enfatizar que todavía mucho que hacer para investigar el porqué de las preferencias políticas en el Perú. 

Por último, considero necesario mejorar los índices que hemos apreciado en esta base de datos. Puesto que, si las cosas continúan como hasta ahora, la realidad es que la ciudadanía va a buscar a cualquier candidato que prometa el oro y el moro, todo con tal de mejorar sus condiciones de vida. Por ello, para evitar la llegada de otro personaje improvisado al sillón de Pizarro es necesario que se mejoren las condiciones de calidad de vida. Solamente así, el Perú saldrá adelante. 


# Link de Github
https://github.com/LuisFi18/Llanos-Clemente-TG-2-ESTADISTICA

# Link de Youtube
https://youtu.be/KygKFBJgR2g














































